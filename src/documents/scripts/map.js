var sampleData = [{ "type" : "Feature",
	"geometry" : {
                "type" : "Point",
                "coordinates" : [37.7608337,140.4747282]
        },
        "properties" : {
        	"name" : "Fukushima",
        	"type" : "extinction_sites",
        	"location" : "Okuma, Fukushima, Japan",
        	"description_short" : "The Fukushima Daiichi nuclear disaster was a nuclear disaster at the Fukushima I Nuclear Power Plant on 11 March 2011, resulting in a meltdown of three of the plant's six nuclear reactors.",
        	"description_long" : "The Fukushima Daiichi nuclear disaster was a nuclear disaster at the Fukushima I Nuclear Power Plant on 11 March 2011, resulting in a meltdown of three of the plant's six nuclear reactors.",
        	"thumbnail" : "img.png",
        	"video" : "",
        	"date_established" : "2011",
        	"people" : "",
        	"category" : "",
        	"category_specific" : "",
        	"link1_title" : "Wikipedia on Fukushima",
        	"link1_url" : "http://en.wikipedia.org/wiki/Fukushima_Daiichi_nuclear_disaster",
        	"link2_title" : "",
        	"link2_url" : "",
        	}
        },
         { "type" : "Feature",
	"geometry" : {
                "type" : "Point",
                "coordinates" : [72.932804, 19.054658]
        },
        "properties" : {
        	"name" : "AMEG",
        	"type" : "case_studies",
        	"location" : "",
        	"description_short" : "AMEG is a group of determined scientists, engineers, communicators and others, dedicated firstly to establishing what really is happening to our planet. ",
        	"description_long" : "AMEG is a group of determined scientists, engineers, communicators and others, dedicated firstly to establishing what really is happening to our planet ",
        	"thumbnail" : "",
        	"video" : "<iframe width='560' height='315' src='//www.youtube.com/embed/iSsPHytEnJM' frameborder='0' allowfullscreen></iframe>",
        	"date_established" : "",
        	"people" : "John Nissen, Peter Wadhams, Stephen Salter, Brian Orr, Peter Carter, Sam Carana, Anthony Cook, Gary Houser, John Hughes, Graham Ennis",
        	"category" : "Finite",
        	"category_specific" : "Climate",
        	"link1_title" : "AMEG website",
        	"link1_url" : "http://www.ameg.me/",
        	"link2_title" : "Message from the Arctic Methane Emergency Group",
        	"link2_url" : "http://a-m-e-g.blogspot.co.uk/2012/05/message-from-arctic-methane-emergency.html",
        	}
        },
         { "type" : "Feature",
	"geometry" : {
                "type" : "Point",
                "coordinates" : [0,0]
        },
        "properties" : {
        	"name" : "BITNATION",
        	"type" : "case_studies",
        	"location" : "",
        	"description_short" : "BITNATION is a full stack governance system.",
        	"description_long" : "BITNATION provides a full range of services traditionally offered by governments. Among these services are: a cryptographically secure ID system, blockchain based dispute resolution, marriage and divorce, land registry, education, insurance, security, diplomacy, and more through a fully distributed platform.",
        	"thumbnail" : "img.png",
        	"video" : "<iframe width='560' height='315' src='//www.youtube.com/embed/8Zp9LvrEzQY' frameborder='0' allowfullscreen></iframe>",
        	"date_established" : "",
        	"people" : "Susanne Tarkowski Tempelhof",
        	"category" : "Despair",
        	"category_specific" : "",
        	"link1_title" : "bitnation.co",
        	"link1_url" : "http://www.bitnation.co/",
        	"link2_title" : "",
        	"link2_url" : "",
        	}
        },
         { "type" : "Feature",
	"geometry" : {
                "type" : "Point",
                "coordinates" : [-0.020588, 51.501322]
        },
        "properties" : {
        	"name" : "Ethereum",
        	"type" : "case_studies",
        	"location" : "",
        	"description_short" : "Ethereum is a platform and a programming language that makes it possible for any developer to build and publish next-generation distributed applications.",
        	"description_long" : "Ethereum is a platform and a programming language that makes it possible for any developer to build and publish next-generation distributed applications.",
        	"thumbnail" : "",
        	"video" : "<iframe width='560' height='315' src='//www.youtube.com/embed/Clw-qf1sUZg' frameborder='0' allowfullscreen></iframe>",
        	"date_established" : "",
        	"people" : "Gavin Wood",
        	"category" : "Infrastructure",
        	"category_specific" : "Civilisation",
        	"link1_title" : "Ethereum website",
        	"link1_url" : "https://www.ethereum.org/",
        	"link2_title" : "",
        	"link2_url" : "",
        	}
        },
         { "type" : "Feature",
	"geometry" : {
                "type" : "Point",
                "coordinates" : [2.36654, 48.825578]
        },
        "properties" : {
        	"name" : "Geeks Without Bounds",
        	"type" : "case_studies",
        	"location" : "",
        	"description_short" : "Geeks Without Bounds is an accelerator for humanitarian projects.",
        	"description_long" : "Geeks Without Bounds is an accelerator for humanitarian projects, mentoring good intentions to a state of deployment.Communication technologies amplify intent; they do not solve human problems. GWB Accelerators are about making intent match application, bridging the gap between technological capabilties and institutional knowledge within humanitarian response.",
        	"thumbnail" : "",
        	"video" : "<iframe width='420' height='315' src='//www.youtube.com/embed/Ny6wq3A6U_I' frameborder='0' allowfullscreen></iframe>",
        	"date_established" : "2010",
        	"people" : "Willow Brugh",
        	"category" : "Humanatarian",
        	"category_specific" : "Aid",
        	"link1_title" : "gwob.org",
        	"link1_url" : "http://gwob.org/",
        	"link2_title" : "",
        	"link2_url" : "",
        	}
        },
         { "type" : "Feature",
	"geometry" : {
                "type" : "Point",
                "coordinates" : [-0.093243, 51.513283]
        },
        "properties" : {
        	"name" : "Hack4Good",
        	"type" : "case_studies",
        	"location" : "",
        	"description_short" : "The planet's biggest ever global hack against climate change.",
        	"description_long" : "The planet's biggest ever global hack against climate change.",
        	"thumbnail" : "",
        	"video" : "<iframe width='560' height='315' src='//www.youtube.com/embed/1KmTvL1G7P8' frameborder='0' allowfullscreen></iframe>",
        	"date_established" : "",
        	"people" : "",
        	"category" : "Finite",
        	"category_specific" : "Climate",
        	"link1_title" : "hack4good.io",
        	"link1_url" : "http://hack4good.io/",
        	"link2_title" : "",
        	"link2_url" : "",
        	}
        },
         { "type" : "Feature",
	"geometry" : {
                "type" : "Point",
                "coordinates" : [-124.079163, 40.877246]
        },
        "properties" : {
        	"name" : "Appropedia",
        	"type" : "case_studies",
        	"location" : "",
        	"description_short" : "Appropedia is the site for collaborative solutions in sustainability, poverty reduction and international development through appropriate technology.",
        	"description_long" : "Appropropedia is a green living wiki for all matters of international development and aid. As an open site it encourages sharing information and collaborating with others in order to lighten our ecological footprint and live rich, sustainable lives in harmony with nature and our environment.",
        	"thumbnail" : "",
        	"video" : "<iframe width='560' height='315' src='//www.youtube.com/embed/iob4x98LCl0?list=UU01xD3RFZ1J1kQ3NQw9Kg4g' frameborder='0' allowfullscreen></iframe>",
        	"date_established" : "2006",
        	"people" : "",
        	"category" : "Infrastructure",
        	"category_specific" : "Civilisation",
        	"link1_title" : "appropedia.org",
        	"link1_url" : "http://www.appropedia.org/",
        	"link2_title" : "",
        	"link2_url" : "",
        	}
        },
         { "type" : "Feature",
	"geometry" : {
                "type" : "Point",
                "coordinates" : [-94.3757042, 39.8616269]
        },
        "properties" : {
        	"name" : "Open Source Ecology",
        	"type" : "case_studies",
        	"location" : "",
        	"description_short" : "Open Source Ecology (OSE) is a network of farmers, engineers, architects and supporters, whose main goal is the eventual manufacturing of the Global Village Construction Set (GVCS). ",
        	"description_long" : "Open Source Ecology (OSE) is a network of farmers, engineers, architects and supporters, whose main goal is the eventual manufacturing of the Global Village Construction Set (GVCS). As described by Open Source Ecology 'the GVCS is an open technological platform that allows for the easy fabrication of the 50 different Industrial Machines that it takes to build a small civilization with modern comforts.' Groups in Oberlin, Ohio, Pennsylvania, New York and California are developing blueprints, and building prototypes in order to pass them on to Missouri. The devices are built and tested on the Factor e Farm in rural Missouri.",
        	"thumbnail" : "",
        	"video" : "<iframe src='//player.vimeo.com/video/58165438' width='500' height='281' webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>",
        	"date_established" : "2003",
        	"people" : "Marcin Jakubowski",
        	"category" : "Infrastructure",
        	"category_specific" : "Open Source",
        	"link1_title" : "opensourceecology.org",
        	"link1_url" : "http://opensourceecology.org/",
        	"link2_title" : "oseeurope.org",
        	"link2_url" : "http://oseeurope.org/",
        	}
        },
];


L.mapbox.accessToken = 'pk.eyJ1IjoiZ2FtZXJhIiwiYSI6IjNlclVnZDAifQ.a8PjkEfE5i2aOShPawCy1A';
var map = L.mapbox.map('map', 'extinctly.f3ad5588', {
	zoomControl: true,
}).setView([30,-25], 3);


var layer = L.mapbox.tileLayer('extinctly.81df0075')
    // since layers load asynchronously through AJAX, use the
    // `.on` function to listen for them to be loaded before
    // calling `getTileJSON()`
    .on('ready', function() {
        // get TileJSON data from the loaded layer
        var TileJSON = layer.getTileJSON();
    });
layer.addTo(map);
map.scrollWheelZoom.disable();


var layer_groups = {'finite': 'Finite', 'civilisation': 'Civilisation', 'ecology':'Ecology','humanitarian_aid':'Humanitarian Aid','infrastructure':'Infrastructure','despair':'Despair','finance':'Finance','conflict_resolution':'Conflict Resolution'};
var datasets = {"population": "Population", "resource_minerals": "Resource Minerals", "oil_natural_gas":"Oil and Natural Gas", "co2_levels":"CO2 Levels"};
var types = {"artist":"0", "project":"1", "case_study":"2","extinction_site":"3"};
var mapLayerGroups = [];

/* Create box to change overlays */
dataset_layers = L.control.layers(null, null, {
	collapsed: false
}).addTo(map);

dataset_layers.addOverlay(layer, 'TEST DATA');


/*for(var key in datasets) {
	var data_name = key;
	data_name = L.layerGroup();
	dataset_layers.addOverlay(data_name, datasets[key]);
}*/

//Style markers
var geojsonMarkerOptions1 = {
	radius: 10,
	fillColor: "rgb(227, 229, 179)",
	color: "rgb(227, 229, 179)",
	weight: 7,
	opacity: 0.4,
	fillOpacity: 0.8,
};

var project = L.icon({
	iconUrl: 'img/map_extinction.png',
	iconAnchor:   [12, 5],
});

L.geoJson(sampleData, {
	pointToLayer: function (feature, latlng) {
		var marker = L.marker(latlng, {icon: project});
		return marker;
	},
	onEachFeature: onEachFeature
}).on('mouseover', function(e) {
	e.layer.openPopup();
});

function onEachFeature(feature, featureLayer) {
    // Does layerGroup already exist? If not create it and add to map
    var layer_group = mapLayerGroups[feature.properties.category];
    if (layer_group === undefined) {
        layer_group = new L.layerGroup();
        // Add the layer to the map
        layer_group.addTo(map);
        // Store layer
        mapLayerGroups[feature.properties.category] = layer_group;
    }
    // Add the feature to the layer
    layer_group.addLayer(featureLayer);

	var url = feature.properties.name.replace(/ /g,"-").replace(/[^a-zA-Z0-9 -]/g, '').toLowerCase();
	featureLayer.bindPopup('<h2>'+ feature.properties.name +'</h2><p>'+ feature.properties.description_short + '</p><a class="lead" href="#'+ url +'" data-toggle="modal" data-target="#'+ url +'">Read more</a>');
	// Creat modals based on content type
    switch (feature.properties.type) {
    	case 'case_studies': createCaseStudy(feature);
    	case 'extinction_sites': createExtinctionSite(feature);
    }
}

function createCaseStudy(geojson) {
	var modal = document.createElement("div");
	var modal_url = geojson.properties.name.replace(/ /g,"-").replace(/[^a-zA-Z0-9 -]/g, '').toLowerCase();
	modal.id = modal_url;
	modal.className = "modal fade";
	modal.innerHTML = '<div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button><h2 class="modal-title">'+ geojson.properties.name +'</h2></div><div class="modal-body"><p class="lead">'+ geojson.properties.description_short +'</p>'+ geojson.properties.video +'<p>'+ geojson.properties.description_long+'</p><p><a href="'+ geojson.properties.link1_url +'" target="_blank">'+ geojson.properties.link1_title +'</a></p></div></div></div>';
	document.body.appendChild(modal);
	var anchor = '#' + modal_url;
    $(anchor).urlModal();
}

function createExtinctionSite(geojson) {
	var modal = document.createElement("div");
	var modal_url = geojson.properties.name.replace(/ /g,"-").replace(/[^a-zA-Z0-9 -]/g, '').toLowerCase();
	modal.id = modal_url;
	modal.className = "modal fade";
	modal.innerHTML = '<div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button><h2 class="modal-title">'+ geojson.properties.name +'</h2></div><div class="modal-body"><p class="lead">'+ geojson.properties.description_short +'</p><p><a href="'+ geojson.properties.link1_url+'" target="_blank">'+ geojson.properties.link1_title +'</a></p></div></div></div>';
	document.body.appendChild(modal);
	var anchor = '#' + modal_url;
    $(anchor).urlModal();
}

document.getElementById('filter-despair').onclick = function () {
    var layer_group = mapLayerGroups['despair'];
		for(var key in layer_groups) {
			var layer_name = key;
			// **Remove if statement before production, temp fix before all data is loaded
			if(mapLayerGroups[layer_name] != undefined) {
				var layer_category = mapLayerGroups[layer_name];
	    	map.removeLayer(layer_category);
			}
		}
    map.addLayer(layer_group);   
} 

document.getElementById('filter-infra').onclick = function () {
    var layer_group = mapLayerGroups['infrastructure'];
		for(var key in layer_groups) {
			var layer_name = key;
			// **Remove if statement before production, temp fix before all data is loaded
			if(mapLayerGroups[layer_name] != undefined) {
				var layer_category = mapLayerGroups[layer_name];
	    	map.removeLayer(layer_category);
			}
		}
    map.addLayer(layer_group);   
}

document.getElementById('filter-civil').onclick = function () {
    var layer_group = mapLayerGroups['civilisation'];
		for(var key in layer_groups) {
			var layer_name = key;
			// **Remove if statement before production, temp fix before all data is loaded
			if(mapLayerGroups[layer_name] != undefined) {
				var layer_category = mapLayerGroups[layer_name];
	    	map.removeLayer(layer_category);
			}
		}
    map.addLayer(layer_group);   
}

document.getElementById('filter-all').onclick = function () {
		for(var key in layer_groups) {
			var layer_name = key;
			// **Remove if statement before production, temp fix before all data is loaded
			if(mapLayerGroups[layer_name] != undefined) {
				var layer_category = mapLayerGroups[layer_name];
	    	map.addLayer(layer_category);
			}
		}
}

